}
QAvgYsiPlot_marine_error(selectysidata,"Chl","Chlorophyll","Chlorophyll (ug/L)",1)
surysidata<- selectysidata %>%
dplyr::filter(parameter=="Chl"&depth=="Surface")%>%
dplyr::select(year,quarter,year_quarter,corrected_mean)%>%
dplyr::group_by(year_quarter)%>%
dplyr::summarize(N=n(),year=mean(year),quarter=mean(quarter),average_value=mean(corrected_mean),
SE=sd(corrected_mean)/sqrt(length(corrected_mean)),
lower.ci = ifelse(N==1,NA,average_value - stats::qt(1 - (0.05 / 2), N - 1) * SE),
upper.ci = ifelse(N==1,NA,average_value + stats::qt(1 - (0.05 / 2), N - 1) * SE),
lower.ci = ifelse(lower.ci<0,0.000000000000000000001,lower.ci))%>%
dplyr::mutate(errorup=upper.ci,errordown=lower.ci)
botysidata<- selectysidata %>%
dplyr::filter(parameter=="Chl"&depth=="Bottom")%>%
dplyr::select(year,quarter,year_quarter,corrected_mean)%>%
dplyr::group_by(year_quarter)%>%
dplyr::summarize(N=n(),year=mean(year),quarter=mean(quarter),average_value=mean(corrected_mean),
SE=sd(corrected_mean)/sqrt(length(corrected_mean)),
lower.ci = ifelse(N==1,NA,average_value-stats::qt(1 - (0.05 / 2), N - 1) * SE),
upper.ci = ifelse(N==1,NA,average_value+stats::qt(1 - (0.05 / 2), N - 1) * SE),
lower.ci = ifelse(lower.ci<0,0.0000000000000000000000001,lower.ci))%>%
dplyr::mutate(errorup=upper.ci,errordown=lower.ci)
yearquarters<-unique(selectysidata$year_quarter)
minyearquarter<-min(yearquarters)
maxyearquarter<-max(yearquarters)
yearquarterscomplete<-seq(minyearquarter,maxyearquarter,by=0.25)
alldates<-data.frame(list(year_quarter=yearquarterscomplete))
botysidata2 <- dplyr::left_join(alldates,botysidata,dplyr::join_by("year_quarter"))
ysidata2 <- rbind(data.frame(surysidata2,"depth"=rep("Surface",nrow(surysidata2))),data.frame(botysidata2,"depth"=rep("Bottom",nrow(botysidata2))))
surysidata2 <- dplyr::left_join(alldates,surysidata,dplyr::join_by("year_quarter"))
ysidata2 <- rbind(data.frame(surysidata2,"depth"=rep("Surface",nrow(surysidata2))),data.frame(botysidata2,"depth"=rep("Bottom",nrow(botysidata2))))
limits<- aes(x=year_quarter,ymin=errordown,ymax=errorup)
View(ysidata2)
QAvgYsiPlot_marine_error <-
function(x,param,main.title,y.label,axis.digits){
yearquarters<-unique(x$year_quarter)
minyearquarter<-min(yearquarters)
maxyearquarter<-max(yearquarters)
yearquarterscomplete<-seq(minyearquarter,maxyearquarter,by=0.25)
alldates<-data.frame(list(year_quarter=yearquarterscomplete))
y.limits <- c(min(x[x$parameter==param,]$corrected_mean),max(x[x$parameter==param,]$corrected_mean))
surysidata<- x %>%
dplyr::filter(parameter==param&depth=="Surface")%>%
dplyr::select(year,quarter,year_quarter,corrected_mean)%>%
dplyr::group_by(year_quarter)%>%
dplyr::summarize(N=n(),year=mean(year),quarter=mean(quarter),average_value=mean(corrected_mean),
SE=sd(corrected_mean)/sqrt(length(corrected_mean)),
lower.ci = ifelse(N==1,NA,average_value-stats::qt(1 - (0.05 / 2), N - 1) * SE),
upper.ci = ifelse(N==1,NA,average_value+stats::qt(1 - (0.05 / 2), N - 1) * SE),
lower.ci = ifelse(lower.ci<0,0.000000000001,lower.ci))%>%
dplyr::mutate(errorup=upper.ci,errordown=lower.ci)
surysidata2 <- dplyr::left_join(alldates,surysidata,dplyr::join_by("year_quarter"))
botysidata<- x %>%
dplyr::filter(parameter==param&depth=="Bottom")%>%
dplyr::select(year,quarter,year_quarter,corrected_mean)%>%
dplyr::group_by(year_quarter)%>%
dplyr::summarize(N=n(),year=mean(year),quarter=mean(quarter),average_value=mean(corrected_mean),
SE=sd(corrected_mean)/sqrt(length(corrected_mean)),
lower.ci = ifelse(N==1,NA,average_value-stats::qt(1 - (0.05 / 2), N - 1) * SE),
upper.ci = ifelse(N==1,NA,average_value+stats::qt(1 - (0.05 / 2), N - 1) * SE),
lower.ci = ifelse(lower.ci<0,0.000000000001,lower.ci))%>%
dplyr::mutate(errorup=upper.ci,errordown=lower.ci)
botysidata2 <- dplyr::left_join(alldates,botysidata,dplyr::join_by("year_quarter"))
ysidata2 <- rbind(data.frame(surysidata2,"depth"=rep("Surface",nrow(surysidata2))),data.frame(botysidata2,"depth"=rep("Bottom",nrow(botysidata2))))
limits<- aes(x=year_quarter,ymin=errordown,ymax=errorup)
avgplot <- ggplot2::qplot(year_quarter, average_value,
data=ysidata2,
xlab="Date",
ylab=y.label,
colour=depth,
main=main.title)
maxi <-y.limits[2]
axis.digits <- ifelse(maxi<1,2,ifelse(maxi<10,2,ifelse(maxi<100,1,0)))
avgplotformatted <- avgplot  +ggplot2::geom_errorbar(limits)+ggplot2::scale_y_continuous(limits=y.limits,labels = function(x) format(x, nsmall = axis.digits))
return(avgplot
+ggplot2::geom_errorbar(limits)+ggplot2::scale_y_continuous(limits=y.limits,labels = function(x) format(x, nsmall = axis.digits)))
}
QAvgYsiPlot_marine_error(selectysidata,"Chl","Chlorophyll","Chlorophyll (ug/L)",1)
QAvgYsiPlot_marine_error <-
function(x,param,main.title,y.label,axis.digits){
yearquarters<-unique(x$year_quarter)
minyearquarter<-min(yearquarters)
maxyearquarter<-max(yearquarters)
yearquarterscomplete<-seq(minyearquarter,maxyearquarter,by=0.25)
alldates<-data.frame(list(year_quarter=yearquarterscomplete))
y.limits <- c(min(x[x$parameter==param,]$corrected_mean),max(x[x$parameter==param,]$corrected_mean))
surysidata<- x %>%
dplyr::filter(parameter==param&depth=="Surface")%>%
dplyr::select(year,quarter,year_quarter,corrected_mean)%>%
dplyr::group_by(year_quarter)%>%
dplyr::summarize(N=n(),year=mean(year),quarter=mean(quarter),average_value=mean(corrected_mean),
SE=sd(corrected_mean)/sqrt(length(corrected_mean)),
lower.ci = ifelse(N==1,NA,average_value-stats::qt(1 - (0.05 / 2), N - 1) * SE),
upper.ci = ifelse(N==1,NA,average_value+stats::qt(1 - (0.05 / 2), N - 1) * SE),
lower.ci = ifelse(lower.ci<0,0.01,lower.ci))%>%
dplyr::mutate(errorup=upper.ci,errordown=lower.ci)
surysidata2 <- dplyr::left_join(alldates,surysidata,dplyr::join_by("year_quarter"))
botysidata<- x %>%
dplyr::filter(parameter==param&depth=="Bottom")%>%
dplyr::select(year,quarter,year_quarter,corrected_mean)%>%
dplyr::group_by(year_quarter)%>%
dplyr::summarize(N=n(),year=mean(year),quarter=mean(quarter),average_value=mean(corrected_mean),
SE=sd(corrected_mean)/sqrt(length(corrected_mean)),
lower.ci = ifelse(N==1,NA,average_value-stats::qt(1 - (0.05 / 2), N - 1) * SE),
upper.ci = ifelse(N==1,NA,average_value+stats::qt(1 - (0.05 / 2), N - 1) * SE),
lower.ci = ifelse(lower.ci<0,0.01,lower.ci))%>%
dplyr::mutate(errorup=upper.ci,errordown=lower.ci)
botysidata2 <- dplyr::left_join(alldates,botysidata,dplyr::join_by("year_quarter"))
ysidata2 <- rbind(data.frame(surysidata2,"depth"=rep("Surface",nrow(surysidata2))),data.frame(botysidata2,"depth"=rep("Bottom",nrow(botysidata2))))
limits<- aes(x=year_quarter,ymin=errordown,ymax=errorup)
avgplot <- ggplot2::qplot(year_quarter, average_value,
data=ysidata2,
xlab="Date",
ylab=y.label,
colour=depth,
main=main.title)
maxi <-y.limits[2]
axis.digits <- ifelse(maxi<1,2,ifelse(maxi<10,2,ifelse(maxi<100,1,0)))
avgplotformatted <- avgplot  +ggplot2::geom_errorbar(limits)+ggplot2::scale_y_continuous(limits=y.limits,labels = function(x) format(x, nsmall = axis.digits))
return(avgplot
+ggplot2::geom_errorbar(limits)+ggplot2::scale_y_continuous(limits=y.limits,labels = function(x) format(x, nsmall = axis.digits)))
}
QAvgYsiPlot_marine_error(selectysidata,"Chl","Chlorophyll","Chlorophyll (ug/L)",1)
surysidata<- x %>%
dplyr::filter(parameter==param&depth=="Surface")%>%
dplyr::select(year,quarter,year_quarter,corrected_mean)%>%
dplyr::group_by(year_quarter)%>%
dplyr::summarize(N=n(),year=mean(year),quarter=mean(quarter),average_value=mean(corrected_mean),
SE=sd(corrected_mean)/sqrt(length(corrected_mean)),
lower.ci = ifelse(N==1,NA,average_value-stats::qt(1 - (0.05 / 2), N - 1) * SE),
upper.ci = ifelse(N==1,NA,average_value+stats::qt(1 - (0.05 / 2), N - 1) * SE),
lower.ci = ifelse(lower.ci<0,1,lower.ci))%>%
dplyr::mutate(errorup=upper.ci,errordown=lower.ci)
surysidata2 <- dplyr::left_join(alldates,surysidata,dplyr::join_by("year_quarter"))
QAvgYsiPlot_marine_error <-
function(x,param,main.title,y.label,axis.digits){
yearquarters<-unique(x$year_quarter)
minyearquarter<-min(yearquarters)
maxyearquarter<-max(yearquarters)
yearquarterscomplete<-seq(minyearquarter,maxyearquarter,by=0.25)
alldates<-data.frame(list(year_quarter=yearquarterscomplete))
y.limits <- c(min(x[x$parameter==param,]$corrected_mean),max(x[x$parameter==param,]$corrected_mean))
surysidata<- x %>%
dplyr::filter(parameter==param&depth=="Surface")%>%
dplyr::select(year,quarter,year_quarter,corrected_mean)%>%
dplyr::group_by(year_quarter)%>%
dplyr::summarize(N=n(),year=mean(year),quarter=mean(quarter),average_value=mean(corrected_mean),
SE=sd(corrected_mean)/sqrt(length(corrected_mean)),
lower.ci = ifelse(N==1,NA,average_value-stats::qt(1 - (0.05 / 2), N - 1) * SE),
upper.ci = ifelse(N==1,NA,average_value+stats::qt(1 - (0.05 / 2), N - 1) * SE),
lower.ci = ifelse(lower.ci<0,1,lower.ci))%>%
dplyr::mutate(errorup=upper.ci,errordown=lower.ci)
surysidata2 <- dplyr::left_join(alldates,surysidata,dplyr::join_by("year_quarter"))
botysidata<- x %>%
dplyr::filter(parameter==param&depth=="Bottom")%>%
dplyr::select(year,quarter,year_quarter,corrected_mean)%>%
dplyr::group_by(year_quarter)%>%
dplyr::summarize(N=n(),year=mean(year),quarter=mean(quarter),average_value=mean(corrected_mean),
SE=sd(corrected_mean)/sqrt(length(corrected_mean)),
lower.ci = ifelse(N==1,NA,average_value-stats::qt(1 - (0.05 / 2), N - 1) * SE),
upper.ci = ifelse(N==1,NA,average_value+stats::qt(1 - (0.05 / 2), N - 1) * SE),
lower.ci = ifelse(lower.ci<0,1,lower.ci))%>%
dplyr::mutate(errorup=upper.ci,errordown=lower.ci)
botysidata2 <- dplyr::left_join(alldates,botysidata,dplyr::join_by("year_quarter"))
ysidata2 <- rbind(data.frame(surysidata2,"depth"=rep("Surface",nrow(surysidata2))),data.frame(botysidata2,"depth"=rep("Bottom",nrow(botysidata2))))
limits<- aes(x=year_quarter,ymin=errordown,ymax=errorup)
avgplot <- ggplot2::qplot(year_quarter, average_value,
data=ysidata2,
xlab="Date",
ylab=y.label,
colour=depth,
main=main.title)
maxi <-y.limits[2]
axis.digits <- ifelse(maxi<1,2,ifelse(maxi<10,2,ifelse(maxi<100,1,0)))
avgplotformatted <- avgplot  +ggplot2::geom_errorbar(limits)+ggplot2::scale_y_continuous(limits=y.limits,labels = function(x) format(x, nsmall = axis.digits))
return(avgplot
+ggplot2::geom_errorbar(limits)+ggplot2::scale_y_continuous(limits=y.limits,labels = function(x) format(x, nsmall = axis.digits)))
}
QAvgYsiPlot_marine_error(selectysidata,"Chl","Chlorophyll","Chlorophyll (ug/L)",1)
QAvgYsiPlot_marine_error <-
function(x,param,main.title,y.label,axis.digits){
yearquarters<-unique(x$year_quarter)
minyearquarter<-min(yearquarters)
maxyearquarter<-max(yearquarters)
yearquarterscomplete<-seq(minyearquarter,maxyearquarter,by=0.25)
alldates<-data.frame(list(year_quarter=yearquarterscomplete))
y.limits <- c(min(x[x$parameter==param,]$corrected_mean),max(x[x$parameter==param,]$corrected_mean))
surysidata<- x %>%
dplyr::filter(parameter==param&depth=="Surface")%>%
dplyr::select(year,quarter,year_quarter,corrected_mean)%>%
dplyr::group_by(year_quarter)%>%
dplyr::summarize(N=n(),year=mean(year),quarter=mean(quarter),average_value=mean(corrected_mean),
SE=sd(corrected_mean)/sqrt(length(corrected_mean)),
lower.ci = ifelse(N==1,NA,average_value-stats::qt(1 - (0.05 / 2), N - 1) * SE),
upper.ci = ifelse(N==1,NA,average_value+stats::qt(1 - (0.05 / 2), N - 1) * SE),
lower.ci = ifelse(lower.ci<0,p,lower.ci))%>%
dplyr::mutate(errorup=upper.ci,errordown=lower.ci)
surysidata2 <- dplyr::left_join(alldates,surysidata,dplyr::join_by("year_quarter"))
botysidata<- x %>%
dplyr::filter(parameter==param&depth=="Bottom")%>%
dplyr::select(year,quarter,year_quarter,corrected_mean)%>%
dplyr::group_by(year_quarter)%>%
dplyr::summarize(N=n(),year=mean(year),quarter=mean(quarter),average_value=mean(corrected_mean),
SE=sd(corrected_mean)/sqrt(length(corrected_mean)),
lower.ci = ifelse(N==1,NA,average_value-stats::qt(1 - (0.05 / 2), N - 1) * SE),
upper.ci = ifelse(N==1,NA,average_value+stats::qt(1 - (0.05 / 2), N - 1) * SE),
lower.ci = ifelse(lower.ci<0,1,lower.ci))%>%
dplyr::mutate(errorup=upper.ci,errordown=lower.ci)
botysidata2 <- dplyr::left_join(alldates,botysidata,dplyr::join_by("year_quarter"))
ysidata2 <- rbind(data.frame(surysidata2,"depth"=rep("Surface",nrow(surysidata2))),data.frame(botysidata2,"depth"=rep("Bottom",nrow(botysidata2))))
limits<- aes(x=year_quarter,ymin=errordown,ymax=errorup)
avgplot <- ggplot2::qplot(year_quarter, average_value,
data=ysidata2,
xlab="Date",
ylab=y.label,
colour=depth,
main=main.title)
maxi <-y.limits[2]
axis.digits <- ifelse(maxi<1,2,ifelse(maxi<10,2,ifelse(maxi<100,1,0)))
avgplotformatted <- avgplot  +ggplot2::geom_errorbar(limits)+ggplot2::scale_y_continuous(limits=y.limits,labels = function(x) format(x, nsmall = axis.digits))
return(avgplot
+ggplot2::geom_errorbar(limits)+ggplot2::scale_y_continuous(limits=y.limits,labels = function(x) format(x, nsmall = axis.digits)))
}
QAvgYsiPlot_marine_error(selectysidata,"Chl","Chlorophyll","Chlorophyll (ug/L)",1)
QAvgYsiPlot_marine_error <-
function(x,param,main.title,y.label,axis.digits){
yearquarters<-unique(x$year_quarter)
minyearquarter<-min(yearquarters)
maxyearquarter<-max(yearquarters)
yearquarterscomplete<-seq(minyearquarter,maxyearquarter,by=0.25)
alldates<-data.frame(list(year_quarter=yearquarterscomplete))
y.limits <- c(min(x[x$parameter==param,]$corrected_mean),max(x[x$parameter==param,]$corrected_mean))
surysidata<- x %>%
dplyr::filter(parameter==param&depth=="Surface")%>%
dplyr::select(year,quarter,year_quarter,corrected_mean)%>%
dplyr::group_by(year_quarter)%>%
dplyr::summarize(N=n(),year=mean(year),quarter=mean(quarter),average_value=mean(corrected_mean),
SE=sd(corrected_mean)/sqrt(length(corrected_mean)),
lower.ci = ifelse(N==1,NA,average_value-stats::qt(1 - (0.05 / 2), N - 1) * SE),
upper.ci = ifelse(N==1,NA,average_value+stats::qt(1 - (0.05 / 2), N - 1) * SE),
lower.ci = ifelse(lower.ci<0,0,lower.ci))%>%
dplyr::mutate(errorup=upper.ci,errordown=lower.ci)
surysidata2 <- dplyr::left_join(alldates,surysidata,dplyr::join_by("year_quarter"))
botysidata<- x %>%
dplyr::filter(parameter==param&depth=="Bottom")%>%
dplyr::select(year,quarter,year_quarter,corrected_mean)%>%
dplyr::group_by(year_quarter)%>%
dplyr::summarize(N=n(),year=mean(year),quarter=mean(quarter),average_value=mean(corrected_mean),
SE=sd(corrected_mean)/sqrt(length(corrected_mean)),
lower.ci = ifelse(N==1,NA,average_value-stats::qt(1 - (0.05 / 2), N - 1) * SE),
upper.ci = ifelse(N==1,NA,average_value+stats::qt(1 - (0.05 / 2), N - 1) * SE),
lower.ci = ifelse(lower.ci<0,1,lower.ci))%>%
dplyr::mutate(errorup=upper.ci,errordown=lower.ci)
botysidata2 <- dplyr::left_join(alldates,botysidata,dplyr::join_by("year_quarter"))
ysidata2 <- rbind(data.frame(surysidata2,"depth"=rep("Surface",nrow(surysidata2))),data.frame(botysidata2,"depth"=rep("Bottom",nrow(botysidata2))))
limits<- aes(x=year_quarter,ymin=errordown,ymax=errorup)
avgplot <- ggplot2::qplot(year_quarter, average_value,
data=ysidata2,
xlab="Date",
ylab=y.label,
colour=depth,
main=main.title)
maxi <-y.limits[2]
axis.digits <- ifelse(maxi<1,2,ifelse(maxi<10,2,ifelse(maxi<100,1,0)))
avgplotformatted <- avgplot  +ggplot2::geom_errorbar(limits)+ggplot2::scale_y_continuous(limits=y.limits,labels = function(x) format(x, nsmall = axis.digits))
return(avgplot
+ggplot2::geom_errorbar(limits)+ggplot2::scale_y_continuous(limits=y.limits,labels = function(x) format(x, nsmall = axis.digits)))
}
QAvgYsiPlot_marine_error(selectysidata,"Chl","Chlorophyll","Chlorophyll (ug/L)",1)
QAvgYsiPlot_marine_error <-
function(x,param,main.title,y.label,axis.digits){
yearquarters<-unique(x$year_quarter)
minyearquarter<-min(yearquarters)
maxyearquarter<-max(yearquarters)
yearquarterscomplete<-seq(minyearquarter,maxyearquarter,by=0.25)
alldates<-data.frame(list(year_quarter=yearquarterscomplete))
y.limits <- c(min(x[x$parameter==param,]$corrected_mean),max(x[x$parameter==param,]$corrected_mean))
surysidata<- x %>%
dplyr::filter(parameter==param&depth=="Surface")%>%
dplyr::select(year,quarter,year_quarter,corrected_mean)%>%
dplyr::group_by(year_quarter)%>%
dplyr::summarize(N=n(),year=mean(year),quarter=mean(quarter),average_value=mean(corrected_mean),
SE=sd(corrected_mean)/sqrt(length(corrected_mean)),
lower.ci = ifelse(N==1,NA,average_value-stats::qt(1 - (0.05 / 2), N - 1) * SE),
upper.ci = ifelse(N==1,NA,average_value+stats::qt(1 - (0.05 / 2), N - 1) * SE),
lower.ci = ifelse(lower.ci<0,0.0000000000000001,lower.ci))%>%
dplyr::mutate(errorup=upper.ci,errordown=lower.ci)
surysidata2 <- dplyr::left_join(alldates,surysidata,dplyr::join_by("year_quarter"))
botysidata<- x %>%
dplyr::filter(parameter==param&depth=="Bottom")%>%
dplyr::select(year,quarter,year_quarter,corrected_mean)%>%
dplyr::group_by(year_quarter)%>%
dplyr::summarize(N=n(),year=mean(year),quarter=mean(quarter),average_value=mean(corrected_mean),
SE=sd(corrected_mean)/sqrt(length(corrected_mean)),
lower.ci = ifelse(N==1,NA,average_value-stats::qt(1 - (0.05 / 2), N - 1) * SE),
upper.ci = ifelse(N==1,NA,average_value+stats::qt(1 - (0.05 / 2), N - 1) * SE),
lower.ci = ifelse(lower.ci<0,1,lower.ci))%>%
dplyr::mutate(errorup=upper.ci,errordown=lower.ci)
botysidata2 <- dplyr::left_join(alldates,botysidata,dplyr::join_by("year_quarter"))
ysidata2 <- rbind(data.frame(surysidata2,"depth"=rep("Surface",nrow(surysidata2))),data.frame(botysidata2,"depth"=rep("Bottom",nrow(botysidata2))))
limits<- aes(x=year_quarter,ymin=errordown,ymax=errorup)
avgplot <- ggplot2::qplot(year_quarter, average_value,
data=ysidata2,
xlab="Date",
ylab=y.label,
colour=depth,
main=main.title)
maxi <-y.limits[2]
axis.digits <- ifelse(maxi<1,2,ifelse(maxi<10,2,ifelse(maxi<100,1,0)))
avgplotformatted <- avgplot  +ggplot2::geom_errorbar(limits)+ggplot2::scale_y_continuous(limits=y.limits,labels = function(x) format(x, nsmall = axis.digits))
return(avgplot
+ggplot2::geom_errorbar(limits)+ggplot2::scale_y_continuous(limits=y.limits,labels = function(x) format(x, nsmall = axis.digits)))
}
QAvgYsiPlot_marine_error(selectysidata,"Chl","Chlorophyll","Chlorophyll (ug/L)",1)
QAvgYsiPlot_marine_error <-
function(x,param,main.title,y.label,axis.digits){
yearquarters<-unique(x$year_quarter)
minyearquarter<-min(yearquarters)
maxyearquarter<-max(yearquarters)
yearquarterscomplete<-seq(minyearquarter,maxyearquarter,by=0.25)
alldates<-data.frame(list(year_quarter=yearquarterscomplete))
y.limits <- c(min(x[x$parameter==param,]$corrected_mean),max(x[x$parameter==param,]$corrected_mean))
surysidata<- x %>%
dplyr::filter(parameter==param&depth=="Surface")%>%
dplyr::select(year,quarter,year_quarter,corrected_mean)%>%
dplyr::group_by(year_quarter)%>%
dplyr::summarize(N=n(),year=mean(year),quarter=mean(quarter),average_value=mean(corrected_mean),
SE=sd(corrected_mean)/sqrt(length(corrected_mean)),
lower.ci = ifelse(N==1,NA,average_value-stats::qt(1 - (0.05 / 2), N - 1) * SE),
upper.ci = ifelse(N==1,NA,average_value+stats::qt(1 - (0.05 / 2), N - 1) * SE),
lower.ci = ifelse(lower.ci<0,0.1,lower.ci))%>%
dplyr::mutate(errorup=upper.ci,errordown=lower.ci)
surysidata2 <- dplyr::left_join(alldates,surysidata,dplyr::join_by("year_quarter"))
botysidata<- x %>%
dplyr::filter(parameter==param&depth=="Bottom")%>%
dplyr::select(year,quarter,year_quarter,corrected_mean)%>%
dplyr::group_by(year_quarter)%>%
dplyr::summarize(N=n(),year=mean(year),quarter=mean(quarter),average_value=mean(corrected_mean),
SE=sd(corrected_mean)/sqrt(length(corrected_mean)),
lower.ci = ifelse(N==1,NA,average_value-stats::qt(1 - (0.05 / 2), N - 1) * SE),
upper.ci = ifelse(N==1,NA,average_value+stats::qt(1 - (0.05 / 2), N - 1) * SE),
lower.ci = ifelse(lower.ci<0,1,lower.ci))%>%
dplyr::mutate(errorup=upper.ci,errordown=lower.ci)
botysidata2 <- dplyr::left_join(alldates,botysidata,dplyr::join_by("year_quarter"))
ysidata2 <- rbind(data.frame(surysidata2,"depth"=rep("Surface",nrow(surysidata2))),data.frame(botysidata2,"depth"=rep("Bottom",nrow(botysidata2))))
limits<- aes(x=year_quarter,ymin=errordown,ymax=errorup)
avgplot <- ggplot2::qplot(year_quarter, average_value,
data=ysidata2,
xlab="Date",
ylab=y.label,
colour=depth,
main=main.title)
maxi <-y.limits[2]
axis.digits <- ifelse(maxi<1,2,ifelse(maxi<10,2,ifelse(maxi<100,1,0)))
avgplotformatted <- avgplot  +ggplot2::geom_errorbar(limits)+ggplot2::scale_y_continuous(limits=y.limits,labels = function(x) format(x, nsmall = axis.digits))
return(avgplot
+ggplot2::geom_errorbar(limits)+ggplot2::scale_y_continuous(limits=y.limits,labels = function(x) format(x, nsmall = axis.digits)))
}
QAvgYsiPlot_marine_error(selectysidata,"Chl","Chlorophyll","Chlorophyll (ug/L)",1)
QAvgYsiPlot_marine_error <-
function(x,param,main.title,y.label,axis.digits){
yearquarters<-unique(x$year_quarter)
minyearquarter<-min(yearquarters)
maxyearquarter<-max(yearquarters)
yearquarterscomplete<-seq(minyearquarter,maxyearquarter,by=0.25)
alldates<-data.frame(list(year_quarter=yearquarterscomplete))
y.limits <- c(min(x[x$parameter==param,]$corrected_mean),max(x[x$parameter==param,]$corrected_mean))
surysidata<- x %>%
dplyr::filter(parameter==param&depth=="Surface")%>%
dplyr::select(year,quarter,year_quarter,corrected_mean)%>%
dplyr::group_by(year_quarter)%>%
dplyr::summarize(N=n(),year=mean(year),quarter=mean(quarter),average_value=mean(corrected_mean),
SE=sd(corrected_mean)/sqrt(length(corrected_mean)),
lower.ci = ifelse(N==1,NA,average_value-stats::qt(1 - (0.05 / 2), N - 1) * SE),
upper.ci = ifelse(N==1,NA,average_value+stats::qt(1 - (0.05 / 2), N - 1) * SE),
lower.ci = ifelse(lower.ci<0,0.1,lower.ci))%>%
dplyr::mutate(errorup=upper.ci,errordown=lower.ci)
surysidata2 <- dplyr::left_join(alldates,surysidata,dplyr::join_by("year_quarter"))
botysidata<- x %>%
dplyr::filter(parameter==param&depth=="Bottom")%>%
dplyr::select(year,quarter,year_quarter,corrected_mean)%>%
dplyr::group_by(year_quarter)%>%
dplyr::summarize(N=n(),year=mean(year),quarter=mean(quarter),average_value=mean(corrected_mean),
SE=sd(corrected_mean)/sqrt(length(corrected_mean)),
lower.ci = ifelse(N==1,NA,average_value-stats::qt(1 - (0.05 / 2), N - 1) * SE),
upper.ci = ifelse(N==1,NA,average_value+stats::qt(1 - (0.05 / 2), N - 1) * SE),
lower.ci = ifelse(lower.ci<0,0.1,lower.ci))%>%
dplyr::mutate(errorup=upper.ci,errordown=lower.ci)
botysidata2 <- dplyr::left_join(alldates,botysidata,dplyr::join_by("year_quarter"))
ysidata2 <- rbind(data.frame(surysidata2,"depth"=rep("Surface",nrow(surysidata2))),data.frame(botysidata2,"depth"=rep("Bottom",nrow(botysidata2))))
limits<- aes(x=year_quarter,ymin=errordown,ymax=errorup)
avgplot <- ggplot2::qplot(year_quarter, average_value,
data=ysidata2,
xlab="Date",
ylab=y.label,
colour=depth,
main=main.title)
maxi <-y.limits[2]
axis.digits <- ifelse(maxi<1,2,ifelse(maxi<10,2,ifelse(maxi<100,1,0)))
avgplotformatted <- avgplot  +ggplot2::geom_errorbar(limits)+ggplot2::scale_y_continuous(limits=y.limits,labels = function(x) format(x, nsmall = axis.digits))
return(avgplot
+ggplot2::geom_errorbar(limits)+ggplot2::scale_y_continuous(limits=y.limits,labels = function(x) format(x, nsmall = axis.digits)))
}
QAvgYsiPlot_marine_error(selectysidata,"Chl","Chlorophyll","Chlorophyll (ug/L)",1)
devtools::check()
devtools::install()
devtools::check()
devtools::install()
devtools::install()
load("~/PACNAquaticWaterQuality/data/kahocentralnutdata.rda")
yearquarters<-unique(kahocentralnutdata$year_quarter)
minyearquarter<-min(yearquarters)
maxyearquarter<-max(yearquarters)
yearquarterscomplete<-seq(minyearquarter,maxyearquarter,by=0.25)
alldates<-data.frame(list(year_quarter=yearquarterscomplete))
surnutdata<- kahocentralnutdata %>%
dplyr::filter(parameter==param&depth=="Surface")%>%
dplyr::select(year,quarter,year_quarter,mean_value)%>%
dplyr::group_by(year_quarter)%>%
dplyr::summarize(N=n(),year=mean(year),quarter=mean(quarter),average_value=mean(mean_value),
SE=sd(mean_value)/sqrt(length(mean_value)),
lower.ci = ifelse(N==1,NA,average_value-stats::qt(1 - (0.05 / 2), N - 1) * SE),
upper.ci = ifelse(N==1,NA,average_value+stats::qt(1 - (0.05 / 2), N - 1) * SE),
lower.ci = ifelse(lower.ci<0,0,lower.ci))%>%
dplyr::mutate(errorup=upper.ci,errordown=lower.ci)
surnutdata2 <- dplyr::left_join(alldates,surnutdata,dplyr::join_by("year_quarter"))
botnutdata<- kahocentralnutdata %>%
dplyr::filter(parameter==param&depth=="Bottom")%>%
dplyr::select(year,quarter,year_quarter,mean_value)%>%
dplyr::group_by(year_quarter)%>%
dplyr::summarize(N=n(),year=mean(year),quarter=mean(quarter),average_value=mean(mean_value),
SE=sd(mean_value)/sqrt(length(mean_value)),
lower.ci = ifelse(N==1,NA,average_value-stats::qt(1 - (0.05 / 2), N - 1) * SE),
upper.ci = ifelse(N==1,NA,average_value+stats::qt(1 - (0.05 / 2), N - 1) * SE),
lower.ci = ifelse(lower.ci<0,0,lower.ci))%>%
dplyr::mutate(errorup=upper.ci,errordown=lower.ci)
botnutdata2 <- dplyr::left_join(alldates,botnutdata,dplyr::join_by("year_quarter"))
library(dplyr)
surnutdata<- kahocentralnutdata %>%
dplyr::filter(parameter==param&depth=="Surface")%>%
dplyr::select(year,quarter,year_quarter,mean_value)%>%
dplyr::group_by(year_quarter)%>%
dplyr::summarize(N=n(),year=mean(year),quarter=mean(quarter),average_value=mean(mean_value),
SE=sd(mean_value)/sqrt(length(mean_value)),
lower.ci = ifelse(N==1,NA,average_value-stats::qt(1 - (0.05 / 2), N - 1) * SE),
upper.ci = ifelse(N==1,NA,average_value+stats::qt(1 - (0.05 / 2), N - 1) * SE),
lower.ci = ifelse(lower.ci<0,0,lower.ci))%>%
dplyr::mutate(errorup=upper.ci,errordown=lower.ci)
surnutdata<- kahocentralnutdata %>%
dplyr::filter(parameter=="TDP"&depth=="Surface")%>%
dplyr::select(year,quarter,year_quarter,mean_value)%>%
dplyr::group_by(year_quarter)%>%
dplyr::summarize(N=n(),year=mean(year),quarter=mean(quarter),average_value=mean(mean_value),
SE=sd(mean_value)/sqrt(length(mean_value)),
lower.ci = ifelse(N==1,NA,average_value-stats::qt(1 - (0.05 / 2), N - 1) * SE),
upper.ci = ifelse(N==1,NA,average_value+stats::qt(1 - (0.05 / 2), N - 1) * SE),
lower.ci = ifelse(lower.ci<0,0,lower.ci))%>%
dplyr::mutate(errorup=upper.ci,errordown=lower.ci)
surnutdata2 <- dplyr::left_join(alldates,surnutdata,dplyr::join_by("year_quarter"))
botnutdata<- kahocentralnutdata %>%
dplyr::filter(parameter=="TDP"&depth=="Bottom")%>%
dplyr::select(year,quarter,year_quarter,mean_value)%>%
dplyr::group_by(year_quarter)%>%
dplyr::summarize(N=n(),year=mean(year),quarter=mean(quarter),average_value=mean(mean_value),
SE=sd(mean_value)/sqrt(length(mean_value)),
lower.ci = ifelse(N==1,NA,average_value-stats::qt(1 - (0.05 / 2), N - 1) * SE),
upper.ci = ifelse(N==1,NA,average_value+stats::qt(1 - (0.05 / 2), N - 1) * SE),
lower.ci = ifelse(lower.ci<0,0,lower.ci))%>%
dplyr::mutate(errorup=upper.ci,errordown=lower.ci)
botnutdata2 <- dplyr::left_join(alldates,botnutdata,dplyr::join_by("year_quarter"))
nutdata2 <- rbind(data.frame(surnutdata2,"depth"=rep("Surface",nrow(surnutdata2))),data.frame(botnutdata2,"depth"=rep("Bottom",nrow(botnutdata2))))
y.limits <- c(min(nutdata2$lower.ci),max(nutdata2$upper.ci))
limits<- aes(ymin=errordown,ymax=errorup)
limits<- ggplot2::aes(ymin=errordown,ymax=errorup)
avgplot <- ggplot2::qplot(year_quarter, average_value,
data=nutdata2,
xlab="Date",
ylab=y.label,
colour=depth,
main=main.title)
avgplot <- ggplot2::qplot(year_quarter, average_value,
data=nutdata2,
xlab="Date",
ylab="label",
colour=depth,
main=main.title)
avgplot <- ggplot2::qplot(year_quarter, average_value,
data=nutdata2,
xlab="Date",
ylab="label",
colour=depth,
main="main.title")
maxi <-y.limits[2]
axis.digits <- ifelse(maxi<1,2,ifelse(maxi<10,2,ifelse(maxi<100,1,0)))
avgplotformatted <- avgplot  +ggplot2::geom_errorbar(limits)+ggplot2::scale_y_continuous(limits=y.limits,labels = function(x) format(x, nsmall = axis.digits))
View(nutdata2)
y.limits <- c(min(nutdata2$lower.ci,na.rm=T),max(nutdata2$upper.ci,na.rm=T))
limits<- ggplot2::aes(ymin=errordown,ymax=errorup)
avgplot <- ggplot2::qplot(year_quarter, average_value,
data=nutdata2,
xlab="Date",
ylab="label",
colour=depth,
main="main.title")
maxi <-y.limits[2]
axis.digits <- ifelse(maxi<1,2,ifelse(maxi<10,2,ifelse(maxi<100,1,0)))
avgplotformatted <- avgplot  +ggplot2::geom_errorbar(limits)+ggplot2::scale_y_continuous(limits=y.limits,labels = function(x) format(x, nsmall = axis.digits))
devtools::install()
devtools::check()
devtools::install()
devtools::check()
devtools::install()
